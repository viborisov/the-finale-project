# Поисковый движок по сайтам

Проект представляет собой мини-поисковую систему, которая:

- индексирует указанные сайты,
- сохраняет структуру страниц и леммы слов в базе данных,
- позволяет выполнять поиск по леммам,
- считает релевантность страниц,
- возвращает результаты с сниппетами, где совпадения подсвечены.

Индексация выполняется многопоточно: для обхода ссылок используется `ForkJoinPool`, а для параллельной индексации нескольких сайтов — пул потоков. Это позволяет достаточно быстро обрабатывать даже большие сайты.

## Основные возможности

- **Полная индексация всех сайтов** из конфигурации.
- **Остановка индексации** по запросу.
- **Переиндексация одной страницы** по URL.
- **Поиск по одному сайту или по всем сразу**:
  - разбор запроса на слова,
  - приведение к леммам,
  - отбрасывание слишком частых (малоинформативных) лемм,
  - поиск страниц, где встречаются все леммы запроса,
  - сортировка по релевантности,
  - генерация сниппетов с подсветкой совпадений через `<b>...<b>`.
- **Статистика**:
  - количество сайтов, страниц и лемм;
  - статус индексации по каждому сайту.

## Стек технологий

**Язык и платформа:**

- Java 17+  
- Spring Boot (REST API)

**Слой данных:**

- Spring Data JPA
- Hibernate
- Реляционная БД (MySQL)  
  Таблицы используемые в проекте:
  - `sites`
  - `pages`
  - `lemmas`
  - `search_index` (индексы lemma–page–rank)

**Прочее:**

- Jsoup — для загрузки и парсинга HTML, извлечения текста и тайтлов.
- Lombok — для сокращения шаблонного кода (аннотации `@Getter`, `@Setter`, `@RequiredArgsConstructor`, `@Slf4j` и т.д.).
- Многопоточность:
  - `ExecutorService` — для запуска индексации по нескольким сайтам;
  - `ForkJoinPool` + `RecursiveAction` (`HtmlParser`) — для обхода ссылок внутри сайта.

## Основные REST-эндпоинты

- `GET /startIndexing` — запустить индексацию всех сайтов.
- `GET /stopIndexing` — остановить текущую индексацию.
- `POST /indexPage` — переиндексировать одну страницу по URL  
- `GET /statistics` — получить статистику по сайтам.
- `GET /search` — выполнить поиск.

Пример запроса поиска:

GET /search?query=принцип+работы&site=http://www.playback.ru/&offset=0&limit=20

Параметры:

- `query` — строка поискового запроса (обязательный).
- `site` — URL сайта; если не указан — поиск по всем проиндексированным сайтам.
- `offset` — смещение (для пагинации), по умолчанию `0`.
- `limit` — количество результатов, по умолчанию `20`.

---
## Как запустить проект локально

### 1. Предварительные требования

- Установлен **JDK 17+**
- Установлен **Maven** 
- Развёрнута **СУБД** (MySQL) и создана база данных, например `search_engine`

Пример создания БД в MySQL:

sql
`CREATE DATABASE search_engine
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_unicode_ci;`

  ## Настройка базы данных

В файле `application.yml` нужно указать настройки подключения к базе данных.

### application.yml

yaml
`spring:
  datasource:
    url: jdbc:mysql://localhost:3306/search_engine?useSSL=false&serverTimezone=UTC
    username: root
    password: your_password
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true`

# Сайты, которые будут индексироваться
indexing-settings:
  sites:
    - url: `http://www.example.ru`
      name: `example`
    - url: `https://example2.ru`
      name: `example2`

## Сборка и запуск (Maven)

### Сборка проекта

В корне проекта выполните: bash

`mvn clean package`

После успешной сборки будет создан .jar-файл в папке target.

Запуск приложения

Вариант 1 — через Maven:

`mvn spring-boot:run`

Вариант 2 — запуск собранного .jar:

`java -jar target/search-engine-1.0-SNAPSHOT.jar`

## Запуск из IDE

Откройте проект в IntelliJ IDEA / Eclipse / другой IDE.

Убедитесь, что подтянулись все зависимости и настроен JDK (Java 17+).

Проверьте настройки подключения к БД в application.yml / application.properties.

Найдите класс с аннотацией @SpringBootApplication

Запустите его как обычное Java-приложение (Run).

### Проверка работы API

После запуска приложение по умолчанию доступно по адресу: `http://localhost:8080`

## Примеры запросов

Старт индексации всех сайтов: GET `http://localhost:8080/startIndexing`

Остановка индексации: GET `http://localhost:8080/stopIndexing`

Переиндексация одной страницы: `POST http://localhost:8080/indexPage`
Content-Type: application/json
"https://example.ru/"

Поиск: GET `http://localhost:8080/search?query=принцип+работы&offset=0&limit=20`

# Параметры запроса /search

`query`— строка поискового запроса (обязательный параметр);

`site` — URL сайта (необязательный; если не указан — поиск по всем проиндексированным сайтам);

`offset` — смещение для пагинации (по умолчанию 0);

`limit` — количество результатов на странице (по умолчанию 20).

Формат ответа /search

Ответ содержит:

`count` — общее количество найденных результатов;

`items` — список результатов, где у каждого элемента есть поля:

`site` — URL сайта;

`siteNam`e — имя сайта;

`uri` — путь страницы;

`title` — заголовок страницы;

`snippet` — фрагмент текста с подсветкой совпадений (совпадающие слова обёрнуты в тег <b>...</b>);

`relevance` — относительная релевантность (число от 0 до 1).





